From c56be33c218813b88fbc99601a690ab9bdc6e48f Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Sun, 19 Nov 2017 10:01:13 -0600
Subject: [PATCH 2/2] Revert "workqueue: Fix NULL pointer dereference"

This reverts commit 44540ead8a8a159a4d2a9cb2e3e0b7388cfaa3b1.
---
 kernel/workqueue_internal.h | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/kernel/workqueue_internal.h b/kernel/workqueue_internal.h
index 42d1e3974554..f000c4d6917e 100644
--- a/kernel/workqueue_internal.h
+++ b/kernel/workqueue_internal.h
@@ -9,7 +9,6 @@
 
 #include <linux/workqueue.h>
 #include <linux/kthread.h>
-#include <linux/preempt.h>
 
 struct worker_pool;
 
@@ -61,7 +60,7 @@ struct worker {
  */
 static inline struct worker *current_wq_worker(void)
 {
-	if (in_task() && (current->flags & PF_WQ_WORKER))
+	if (current->flags & PF_WQ_WORKER)
 		return kthread_data(current);
 	return NULL;
 }
-- 
2.15.0

